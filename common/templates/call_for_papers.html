{% extends "base_forms.html" %}

{% block title %}Call for Papers{% endblock title%}

{% block additionalJS %}
<script type="text/javascript">
function load_presenter_search() {
	$("#presenter_results").hide();
	$("#presenter_results").html("");
	$("#presenter_search").show();
}

function find_presenters() {
	var presenter = $("#presenter_name").val();
	$.getJSON("/speaker/find/" + presenter + "/", function(json){
			show_presenters(json)});
	}

function show_presenters(json) {
	$("#presenter_search").hide();
	for (var i = 0; i < json.length; i++) {
		var old = $("#presenter_results").html();
		$("#presenter_results").html(old + "<br /><a href=\"javascript:void(0);\" onclick=\"add_presenter(" + json[i]['id'] + ", '" + json[i]['name'] + "');\">" + json[i]['name'] + "</a>");
	}
	$("#presenter_results").show();
}

function add_presenter(id, name) {
	var old = $("#id_presenter").html();
	$("#id_presenter").html(old + "<option selected value=\"" + id + "\">" + name + "</option>");

}
</script>
{% endblock additionalJS %}

{% block primaryContent %}
<h2>Submit Presentation Proposal</h2>

{% block formsWrapper %}

<div id='error_text'>{{ error }}</div>
<div id='deleted_text'>{{ deleted }}</div>
	
	<div id='form'>
		<form method="post" action="/speaker/papers/{% if abs_id %}{{ abs_id }}/{% endif %}" enctype="multipart/form-data" >
			<table> 
					<tr>
 			    <td><b>{{ user.email }}</b></td><td><b><font size='+2'>{{ user.first_name }} {{ user.last_name }}</font></b></td>
				  </tr>
				{% for field in presenter_form %}
					<tr>
				    <td>{{ field.label_tag }}
				    </td>
					<td>
						{% ifequal field.name "presenter" %}
							{% if field.presenter %}
								{{ field }}
							{% else %}
							<select multiple name="presenter" id="id_presenter" size="4">
								<option value="{{user.id}}" selected>{{user.first_name}} {{user.last_name}}</option>
							</select>
								<br /><a href="javascript:void(0);" onclick="load_presenter_search();">Add additional Presenters</a>
							{% endif %}
						{% else %}
						{{ field }}
						{% ifequal field.name "cat" %}
							<br /><a target="_new" href="/speaker/categories/">Category Descriptions</a> (opens in new window)
						{% endifequal %}
						{% ifequal field.name "audiences" %}
							<br /><a target="_new" href="/speaker/audiences/">Audience Descriptions</a> (opens in new window)
						{% endifequal %}
						{% endifequal %}
					</td>
				    {% if field.help_text %}<td valign="middle">{{ field.help_text }}</td>{% endif %}
				    {% if field.errors %}<td class="error" valign="middle">{{ field.errors }}</td>{% endif %}
				   </tr>
				{% endfor %}
			</table>
			<input type="submit" value="Submit" />
			<div id="presenter_search" style="display: none; background-color: gold;">
				Presenter Name: <input id="presenter_name" name="presenter_name" type="text" /> 
				<input type="button" value="Search" onclick="find_presenters();" />
			</div>
			<div id="presenter_results" style="display: hidden;"></div>
		</form>
	</div>
{% endblock formsWrapper %}

{% endblock primaryContent%}

{% block rightMenu %}
	<h2>Submitted Abstracts</h2>
		<ul>
		{% for abs in abstract_list %}
			<li><a href='/speaker/papers/{{ abs.id }}/'>{{ abs.title }}</a></li>
		{% endfor %}
		</ul>
{% endblock rightMenu %}


