<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>UTOSC 2009 Tracker</title>

<script type="text/javascript" src="/static/js/jquery-1.3.2.min.js"></script>

<script type="text/javascript">

var sinceId = 0;

// 30 sec =  30000
var slideInterval = setInterval("doSomething()", 60000)
// 1 min = 60000
setInterval("getTweets()", 30000)

$('document').ready(function(){

	windowHeight = window.innerHeight
	$('#container').css('height', windowHeight - 20 +'px');
	$('#container').css('max-height', windowHeight - 20 +'px');
	$('#tweetHider').css('max-height', windowHeight - 83 +'px');
	$('#tweetHider').css('height', windowHeight - 83 +'px');
	
	getTweets();
	 
});

function doSomething(){
	$('#tweetHider').slideToggle('slow');
	$('#scheduleHider').slideToggle('slow', function(){
		clearInterval(slideInterval); 
		if( $('#scheduleHider').is(':visible') ){
			slideInterval = setInterval('doSomething()', 10000);
		} else {
			slideInterval = setInterval('doSomething()', 30000);
		}
	 });
}

var tempTweetId

function getTweets(){
$.ajax({
	   type: "POST",
	   url: "http://localhost:8000/updates/twitter/",
	   data: "since="+ sinceId,
	   dataType: 'json',
	   success: function(tweets){

	   		//conver the OBJECT to and ARRAY so we can sort it
	   		tweetArray = new Array();

	   		for ( tweet in tweets['results'] ){
		   		tweetArray[tweet] = new Array();
		   		tweetArray[tweet]['id'] = tweets['results'][tweet]['id'];
		   		tweetArray[tweet]['text'] = tweets['results'][tweet]['text'];
		   		tweetArray[tweet]['date'] = tweets['results'][tweet]['created_at'];
		   		tweetArray[tweet]['profile_image_url'] = tweets['results'][tweet]['profile_image_url'];
		   	}

		   	tweetArray.sort();
		   	tweetArray.reverse();

	   		var startTweet = $('#tweetHider .tweet :first');
	   		for ( tweet in tweetArray ){
				tweetImage = tweetArray[tweet]['profile_image_url'];
				tweetMsg = tweetArray[tweet]['text'];
				tweetDate = tweetArray[tweet]['date'];
				tweetID = tweetArray[tweet]['id'];
	   			var tweetDiv = '<div style="display: none; clear: both;" class="tweet"><img src="'+ tweetImage +'" alt="avatar" /><div>'+ tweetMsg +'</div></div>'
				$('#tweetHider .tweet :first').before(tweetDiv);
			}

	   		tweetArray = new Array();
			
   			if(startTweet != $('#tweetHider .tweet :first')){
		   		var newTweet = startTweet.prev();
		   		slideTweet(newTweet);
	   		}

	   		sinceId = tweets['max_id'];

	   }
 });
}

function slideTweet(tweet){
	tweet.slideDown('slow', function(){
		if(tweet != $('#tweetHider .tweet :first')){
			slideTweet(tweet.prev());
		}
	});
}

</script>

<style type="text/css">

body{
	background-color: #CCC;
	margin: 0;
	padding: 0;
}

#container{
	width: 75%;
	margin: 10px auto;
	border: 1px solid #000;
	border-collapse: collapse;
}

#tweetHeader {
	background: #ACACAC;
	padding: 5px;
	font-weight: bold;
	border-bottom: 1px solid #666;
	border-collapse: collapse;
}

#tweetHider {
	overflow: hidden;
}

.tweet {
	clear: both;
	margin: 20px;
}

.tweet img {
	margin-right: 10px;
	float: left;
}

#schedule{
	border-top: 1px solid #000;
	border-collapse: collapse;
}

#scheduleHeader {
	background: #ACACAC;
	padding: 5px;
	font-weight: bold;
	border-bottom: 1px solid #666;
	border-collapse: collapse;
}

#scheduleHider {
	display: none;
	border-collapse: collapse;
}

</style>

</head>
<body>

<div id="container">
	<div id="tweets">
		<div id="tweetHeader">@utsoc | #utosc2009 | #utosc</div>
		
		<div id="tweetHider">
			<div class="tweet"><img src="http://a3.twimg.com/profile_images/396384595/xbox_avatarpic_large_bigger.png" alt="avatar" /><span>This is a tweet!</span></div>
		</div>
	</div>
	<div id="schedule">
		<div id="scheduleHeader">Coming up!</div>
		<div id="scheduleHider">
			<ul>
				<li>Something to show</li>
			</ul>
		</div>
	</div>
</div>

</body>
</html>
